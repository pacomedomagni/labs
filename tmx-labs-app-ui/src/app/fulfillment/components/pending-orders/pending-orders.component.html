<div class="content-wrapper">
  <!-- Filters Sidebar -->
  <aside class="filters-sidebar">
    <h3 class="filter-title">Filter Orders By</h3>

    <!-- State Filter -->
    <div class="filter-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>State</mat-label>
        <mat-select multiple
                    [value]="selectedStates()"
                    (selectionChange)="selectedStates.set($event.value)">
          @for (state of availableStates(); track state) {
            <mat-option [value]="state">{{ state }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Snapshot Version Filter -->
    <div class="filter-section">
      <div class="filter-label">Snapshot Version</div>
      <mat-button-toggle-group [value]="selectedSnapshotVersion()"
                               (change)="selectedSnapshotVersion.set($event.value)"
                               class="snapshot-toggle-group">
        <mat-button-toggle value="all">All Snapshot Versions</mat-button-toggle>
        <mat-button-toggle value="3.0">Snapshot 3.0</mat-button-toggle>
        <mat-button-toggle value="4.0">Snapshot 4.0</mat-button-toggle>
        <mat-button-toggle value="5.0">Snapshot 5.0</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <!-- Device Type Filter -->
    <div class="filter-section">
      <div class="filter-label">Device Type</div>
      <mat-radio-group [value]="selectedDeviceType()"
                       (change)="selectedDeviceType.set($event.value)"
                       class="radio-group">
        <mat-radio-button value="all">All Devices</mat-radio-button>
        <mat-radio-button value="w8w9">W8/W9</mat-radio-button>
        <mat-radio-button value="wx">WX</mat-radio-button>
        <mat-radio-button value="w8w9wx">W8/W9 &amp; WX</mat-radio-button>
      </mat-radio-group>
    </div>

    <!-- Order Status Filter -->
    <div class="filter-section">
      <div class="filter-label">Order Status</div>
      <div class="checkbox-group">
        <mat-checkbox [checked]="allStatusesSelected()"
                      [indeterminate]="selectedStatuses().length === 1"
                      (change)="onSelectAllStatuses($event.checked)">
          Select All
        </mat-checkbox>
        <mat-checkbox [checked]="selectedStatuses().includes('Pending Assignment')"
                      (change)="onStatusToggle('Pending Assignment', $event.checked)">
          Pending Assignment
        </mat-checkbox>
        <mat-checkbox [checked]="selectedStatuses().includes('Ready to Print')"
                      (change)="onStatusToggle('Ready to Print', $event.checked)">
          Ready to Print
        </mat-checkbox>
      </div>
    </div>

    <!-- Clear Button -->
    <div class="clear-button-container">
      <button mat-flat-button
              color="primary"
              (click)="clearFilters()"
              [disabled]="isFilterDefault()"
              class="clear-button">
        CLEAR
      </button>
    </div>
  </aside>

  <!-- Orders Table -->
  <div class="orders-content">
    <!-- Subheader -->
    <div class="orders-header">
      <div class="orders-count">
        <span>Pending Orders: <strong>{{ filteredPendingCount().toLocaleString() }}</strong></span>
        <span class="count-separator">-</span>
        <span>Devices Needed: <strong>{{ filteredDevicesNeeded().toLocaleString() }}</strong></span>
      </div>
    </div>

    <!-- Table -->
    <div class="table-container">
      <table mat-table [dataSource]="dataSource" matSort class="cui-table orders-table">
        <!-- Order Number Column -->
        <ng-container matColumnDef="orderNumber">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Order #</th>
          <td mat-cell *matCellDef="let order">
            <a href="#" class="order-link" (click)="onOrderClick($event, order)">{{ order.orderNumber }}</a>
          </td>
        </ng-container>

        <!-- Order Date Column -->
        <ng-container matColumnDef="orderDate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Order Date</th>
          <td mat-cell *matCellDef="let order">
            {{ order.orderDate | date:'M/d/yyyy h:mm:ss a' }}
          </td>
        </ng-container>

        <!-- State Column -->
        <ng-container matColumnDef="state">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>State</th>
          <td mat-cell *matCellDef="let order">{{ order.state }}</td>
        </ng-container>

        <!-- Device Count Column -->
        <ng-container matColumnDef="deviceCount">
          <th mat-header-cell *matHeaderCellDef>Device Count</th>
          <td mat-cell *matCellDef="let order">{{ order.nbrDevicesNeeded }}</td>
        </ng-container>

        <!-- Device Type Column -->
        <ng-container matColumnDef="deviceType">
          <th mat-header-cell *matHeaderCellDef>Device Type</th>
          <td mat-cell *matCellDef="let order">{{ order.deviceType }}</td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let order">{{ order.deviceOrderStatusDescription }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"
            [class.old-order]="isOldOrder(row)"
            tabindex="0"
            [attr.aria-label]="'Order ' + row.orderNumber + ', ' + row.state + ', ' + row.nbrDevicesNeeded + ' devices, ' + row.deviceOrderStatusDescription">
        </tr>
      </table>
    </div>

    <!-- Paginator -->
    <mat-paginator
      [pageSizeOptions]="[10, 25, 50]"
      [pageSize]="10"
      showFirstLastButtons
      aria-label="Select page of orders">
    </mat-paginator>
  </div>
</div>
